## Rails でテストを書いてみよう

一人でアプリケーションを作っていると、はじめは簡単な機能しかないので、問題なく動くと思うしその確認も簡単にできると思います。

しかし以下のようなことが起きてくるとどうでしょう？

- 数週間飽きていて開発をしてなかったけど、久しぶりに開発しようと思って触りはじめた
- 順調に開発が進んだので機能が増えてきた
- 一人ではなくチームで開発するようになってきた
- アプリケーションがみんなに受け入れられてユーザーの大事な情報を預かるようになってきた
- アプリケーションのためにお金を払ってくれる人が出てきた
- ...etc

昔書いたコードが思っているのと違う動き方をしたり、そもそもどうやって動くのかさっぱり忘れてしまっていたり

ある機能を作ったことで実は他の機能がうまく動かなくなっていたり、チームの人が勝手に今ある機能の挙動を変えていたり

お客さんの情報が流出してしまったり、お金を払ってくれるくらい良さを感じてくれている大事なユーザーに対して大きな迷惑をかけてしまったり

そんなことが起きてしまうと大変だし、何よりアプリケーションを書くのが楽しくなくなってしまうかもしれません。

そこで現代的なアプリケーション開発ではテストというものを大事にしていて、アプリケーションが正しく動くかどうかを機械的に・人力でチェックする、という方法を採用することが多いです。

今回は Rails アプリケーションにおける基本的なテストの書き方を学んで行きましょう！

### テストって何？

テスト、と一口に言っても様々な種類・方法があります。

しかし共通していることは、アプリケーションが正しく動くことを実際に実行してみて検証すること、だと思います。

例えば以下のようなメソッドがあったとしましょう。

```ruby
def add_10(number)
  number + 10
end
```

これがうまく動いていることを確かめるには

`number` を与えた時にそれに `10` が足された数が返ってくることを確かめてあげればいいですよね。

つまり例えば

- number が 1 なら返ってくるのは 11
- number が 0 なら返ってくるのは 10
- number が -5 なら返ってくるのは 5

というような検証を行えば良さそうです。

簡単に言えば、この `number` と結果の値をあらかじめ考えてあげて、それを確かめるのがテストであると言えそうです。

#### どんなケースを確かめるべきなのか

でもこの number がもし仮に `"ドラえも〜ん"` といった文字列を取りうるとしたら...？

```
irb(main):004:0> add_10("ドラえも〜ん")
Traceback (most recent call last):
        6: from /Users/yusuke/.rbenv/versions/2.6.2/bin/irb:23:in `<main>'
        5: from /Users/yusuke/.rbenv/versions/2.6.2/bin/irb:23:in `load'
        4: from /Users/yusuke/.rbenv/versions/2.6.2/lib/ruby/gems/2.6.0/gems/irb-1.0.0/exe/irb:11:in `<top (required)>'
        3: from (irb):4
        2: from (irb):2:in `add_10'
        1: from (irb):2:in `+'
TypeError (no implicit conversion of Integer into String)
```

大変です！エラーが起きてしまいました。

さっき考えていた `number` は `1`, `0`, `-5` とどれも整数でしたが、実は文字列も考えないといけないとなると、あのメソッドはうまく動かないことがわかりました。

今回の `add_10` メソッドに文字列を渡すなんてそんなことしないよ！と使い方が決まっているのであればこんなことは考えなくていいでしょう。しかしアプリケーションが複雑になってくると考慮が漏れることはしばしば発生します。

常にそのメソッドにはどんな値が渡されるのか、それぞれの場合にどんな結果を返すのか、しっかり考えてあげましょう。

### Rails に関係なく、テストを書いてみよう

説明が長くなってきましたから、そろそろ実際にテストを書いてみましょう。

最終的には Rails で作ったアプリケーションの動作を確かめるテストをかけるといいと思うんですが、まずはその前にテストとは何かを簡単に書いてみましょう。

このドキュメントでは `RSpec` というテスト用のフレームワークを使ってテストを書いていきます。

#### 環境構築

この先に進むには Ruby の `2.6.2` が必要です。もし入っていなければ `rbenv` 等をつかって入れてあげましょう。

このリポジトリを `git clone` してきたら、おきまりのアレをまずやりましょう。

```
bundle install --path vendor/bundle
```

うまくインストールが終われば準備完了です！

#### 簡単なメソッドのテストを書いてみる

### モデルのテストを書いてみよう

### リクエストのテストを書いてみよう


